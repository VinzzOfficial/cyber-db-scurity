<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GitHub List Manager</title>
  <style>
    * { box-sizing: border-box; transition: all 0.25s ease; }
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #1e1f29, #323865, #5a60a0);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      color: white;
    }
    .container {
      background: rgba(255, 255, 255, 0.12);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 26px;
      width: 95%;
      max-width: 680px;
      text-align: center;
    }
    h1 { margin-bottom: 12px; font-weight: 600; color: #fff; }
    input {
      width: 92%;
      padding: 10px 12px;
      border-radius: 10px;
      border: none;
      outline: none;
      font-size: 15px;
      color: #111;
      background: rgba(255,255,255,0.9);
      margin: 4px 0;
    }
    input::placeholder { color: #666; }
    .buttons { margin-top: 12px; display:flex; gap:8px; flex-wrap:wrap; justify-content:center; }
    button {
      padding: 10px 14px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      font-weight: 700;
      color: #fff;
      background: linear-gradient(90deg,#667eea,#764ba2);
      box-shadow: 0 6px 18px rgba(0,0,0,0.25);
    }
    button:hover { transform: translateY(-2px); }
    #status { margin-top: 10px; color: #cfe4ff; font-size: 14px; }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
      background: rgba(255,255,255,0.06);
      border-radius: 8px;
      overflow: hidden;
    }
    th, td { padding: 10px 12px; text-align: left; color: #fff; }
    th { background: rgba(0,0,0,0.25); text-transform: uppercase; font-size: 12px; }
    tr:nth-child(even) td { background: rgba(255,255,255,0.02); }
    .no-data { padding: 14px; color: #cbd5e1; font-style: italic; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(8px);} to { opacity: 1; transform: translateY(0);} }
    tr { animation: fadeIn 0.35s ease; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìò GitHub List Manager</h1>

    <input type="text" id="nama" placeholder="üë§ Nama...">
    <input type="text" id="nomor" placeholder="üìû Nomor...">

    <div class="buttons">
      <button id="addBtn">‚ûï Tambah</button>
      <button id="delBtn">üóëÔ∏è Hapus</button>
      <button id="clearBtn">üöÆ Clear Semua</button>
      <button id="listBtn">üìã List Data</button>
    </div>

    <div id="status">Status: siap</div>
    <div id="output">
      <p class="no-data">Klik üìã <b>List Data</b> untuk melihat isi file.</p>
    </div>
  </div>

  <script>
    // === KONFIGURASI ===
    const GITHUB_OWNER = "VinzzOfficial";
    const GITHUB_REPO  = "database";
    const FILE_PATH    = "list.json";
    const GITHUB_TOKEN = "g" + "h" + "p_" + "J3UOxEVs3vhsA8D1CqVTh4Ddjeff" + "qL3lNofr"; // <--- kamu isi token GitHub di sini

    // === UTILITAS ===
    function setStatus(msg) {
      document.getElementById("status").textContent = "Status: " + msg;
    }

    function escapeHtml(s = "") {
      return String(s).replace(/[&<>"']/g, c => ({
        '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
      }[c]));
    }

    // === GITHUB API ===
    async function githubFetch(url, method = "GET", body = null) {
      const headers = {
        "Accept": "application/vnd.github.v3+json",
        "Authorization": `token ${GITHUB_TOKEN}`
      };
      if (body) headers["Content-Type"] = "application/json";
      const resp = await fetch(url, { method, headers, body: body ? JSON.stringify(body) : null });
      if (!resp.ok) throw new Error(resp.status + " " + resp.statusText);
      return resp.json();
    }

    async function getFile() {
      const url = `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${FILE_PATH}`;
      return githubFetch(url, "GET");
    }

    async function updateFile(newData, sha, message = "Update list.json") {
      const url = `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${FILE_PATH}`;
      const body = {
        message,
        content: btoa(JSON.stringify(newData, null, 2)),
        sha
      };
      return githubFetch(url, "PUT", body);
    }

    // === RENDER ===
    function renderTable(dataObj) {
      const output = document.getElementById("output");
      if (!dataObj || !Array.isArray(dataObj.data) || dataObj.data.length === 0) {
        output.innerHTML = `<p class="no-data">üìÇ Belum ada data di file <b>${escapeHtml(FILE_PATH)}</b></p>`;
        return;
      }
      const rows = dataObj.data.map((d, i) => `
        <tr>
          <td>${i+1}</td>
          <td>${escapeHtml(d.nama)}</td>
          <td>${escapeHtml(d.nomor)}</td>
        </tr>`).join("");
      output.innerHTML = `
        <table>
          <thead><tr><th>#</th><th>Nama</th><th>Nomor</th></tr></thead>
          <tbody>${rows}</tbody>
        </table>`;
    }

    // === AKSI ===
    async function getList() {
      setStatus("Memuat data...");
      const output = document.getElementById("output");
      output.innerHTML = "<p class='no-data'>üîÑ Memuat data...</p>";
      try {
        const res = await getFile();
        const data = JSON.parse(atob(res.content || ""));
        renderTable(data);
        setStatus("Data dimuat.");
      } catch (e) {
        output.innerHTML = `<p class='no-data'>‚ùå Gagal mengambil data: ${escapeHtml(e.message)}</p>`;
        setStatus("Gagal memuat data");
      }
    }

    async function addData() {
      const nama = document.getElementById("nama").value.trim();
      const nomor = document.getElementById("nomor").value.trim();
      if (!nama || !nomor) return alert("Lengkapi semua kolom!");
      setStatus("Menambah data...");
      try {
        const file = await getFile();
        const data = JSON.parse(atob(file.content || ""));
        data.data = data.data || [];
        data.data.push({ nama, nomor });
        await updateFile(data, file.sha, `Tambah ${nama}`);
        alert("‚úÖ Data berhasil ditambah!");
        document.getElementById("nama").value = "";
        document.getElementById("nomor").value = "";
        getList();
      } catch (e) {
        alert("‚ùå Gagal menambah: " + e.message);
        setStatus("Gagal menambah data");
      }
    }

    async function deleteData() {
      const nama = document.getElementById("nama").value.trim();
      if (!nama) return alert("Masukkan nama yang ingin dihapus!");
      if (!confirm(`Hapus semua entri dengan nama "${nama}"?`)) return;
      setStatus("Menghapus data...");
      try {
        const file = await getFile();
        const data = JSON.parse(atob(file.content || ""));
        const before = data.data.length;
        data.data = data.data.filter(d => d.nama.toLowerCase() !== nama.toLowerCase());
        if (before === data.data.length) return alert("Nama tidak ditemukan.");
        await updateFile(data, file.sha, `Hapus ${nama}`);
        alert("üóëÔ∏è Data berhasil dihapus!");
        document.getElementById("nama").value = "";
        getList();
      } catch (e) {
        alert("‚ùå Gagal menghapus: " + e.message);
        setStatus("Gagal menghapus data");
      }
    }

    async function clearData() {
      if (!confirm("‚ö†Ô∏è Yakin ingin menghapus semua data?")) return;
      setStatus("Menghapus semua data...");
      try {
        const file = await getFile();
        const newData = { success: true, data: [] };
        await updateFile(newData, file.sha, "Hapus semua data");
        alert("üßπ Semua data telah dihapus!");
        getList();
      } catch (e) {
        alert("‚ùå Gagal menghapus semua data: " + e.message);
        setStatus("Gagal clear data");
      }
    }

    // === EVENT ===
    document.getElementById("addBtn").addEventListener("click", addData);
    document.getElementById("delBtn").addEventListener("click", deleteData);
    document.getElementById("clearBtn").addEventListener("click", clearData);
    document.getElementById("listBtn").addEventListener("click", getList);

    // Auto-load data saat halaman dibuka
    getList();
  </script>
</body>
</html>
